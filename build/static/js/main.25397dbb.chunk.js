(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{249:function(e){e.exports={app:"Chat",send:"Send",chat:"Chat",clear:"Clear",clearcompletely:"Clear Completely",yourid:"your id:",his:"his",note:"local note",publicchat:"Public Chat"}},250:function(e){e.exports={app:"\u804a\u81f3",send:"\u53d1\u9001",chat:"\u804a\u5929",clear:"\u6e05\u7a7a",clearcompletely:"\u5f7b\u5e95\u6e05\u9664",yourid:"\u4f60\u7684id:",his:"\u5bf9\u65b9",note:"\u672c\u5730\u7b14\u8bb0",publicchat:"\u516c\u5171\u804a\u5929\u5ba4"}},269:function(e,t,n){e.exports=n(426)},281:function(e,t){},311:function(e,t){},313:function(e,t){},323:function(e,t){},325:function(e,t){},352:function(e,t){},354:function(e,t){},355:function(e,t){},360:function(e,t){},362:function(e,t){},368:function(e,t){},370:function(e,t){},389:function(e,t){},401:function(e,t){},404:function(e,t){},426:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),o=n(45),a=n.n(o),c=n(26),u=n(235),l=n(60),f=n(168),s=n(236),d=n.n(s),p=n(36),m=Object(l.a)({usrinfo:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("quickusrinfoid"===t.type){var n=Object(p.cloneDeep)(e);return n.id=t.id,n.long="new",n}if("quickusrinfopubkey"===t.type){var r=Object(p.cloneDeep)(e);return r.pubkey=t.pubkey,r.long="new",r}if("usrinfo"===t.type){var i=Object(p.cloneDeep)(e);return i.id=t.info.id,i.pubkey=t.info.pubkey,i.long="old",i}if("newusrinfo"===t.type){var o=Object(p.cloneDeep)(e);return o.id=t.info.id,o.pubkey=t.info.pubkey,o.long="new",o}return e},sending:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("sendingmsg"===t.type){var n=Object(p.cloneDeep)(e),r={id:t.info.id,fromid:t.info.fromid,time:t.info.time,toid:t.info.toid,text:t.info.text,msgstatus:t.info.msgstatus};return t.info.toid in n?n[t.info.toid].push(r):(n[t.info.toid]=[],n[t.info.toid].push(r)),n}if("sendedmsg"===t.type){var i=Object(p.cloneDeep)(e);return t.toid in i&&i[t.toid].forEach(function(e){e.id===t.msgid&&(e.msgstatus=t.result)}),i}return"cleansending"===t.type?{}:e},received:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("receivedmsg"===t.type){var n=Object(p.cloneDeep)(e),r={id:t.info.id,fromid:t.info.fromid,time:t.info.time,toid:t.info.toid,text:t.info.text};return t.info.fromid in n?n[t.info.fromid].push(r):(n[t.info.fromid]=[],n[t.info.fromid].push(r)),n}if("receivedpubmsg"===t.type){var i=Object(p.cloneDeep)(e),o={id:t.info.id,fromid:t.info.fromid,time:t.info.time,toid:t.info.toid,text:t.info.text};return t.info.toid in i?i[t.info.toid].push(o):(i[t.info.toid]=[],i[t.info.toid].push(o)),i}return"cleanreceived"===t.type?{}:e},comparemd5:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{publicmd5:"",memd5:""},t=arguments.length>1?arguments[1]:void 0;if("genmd5"===t.type){var n=Object(p.cloneDeep)(e);return"pub"===t.id&&(n.publicmd5=t.md5str),"me"===t.id&&(n.memd5=t.md5str),n}return e},incleantime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("incleantime"===t.type){var n=Object(p.cloneDeep)(e);return n[t.id]=t.time,n}return e},viewcleantime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("viewcleantime"===t.type){var n=Object(p.cloneDeep)(e);return n[t.id]=t.time,n}return e},onchatingid:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return"onchatingid"===t.type?t.id:e},newalert:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0;return"newalert"===t.type?t.id:e},decryptmsg:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if("newdecryptmsg"===t.type){var n=Object(p.cloneDeep)(e);return n[t.id]=t.msg,n}return e},lastsendtime:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return"lastsendtime"===t.type?t.time:e},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0;return"testaction"===t.type?t.info:e}}),h=m(void 0,{}),v=function(e,t){return"state_clean"===t.type?h:m(e,t)},g={key:"root",storage:d.a},y=Object(f.a)(g,v,{blacklist:["received"]}),b=Object(l.b)(y),w=Object(f.b)(b),E=n(19),x=n(164),O=n(7),j=n(43),k=n(478),S=n(87),D=n.n(S),I=function(e,t){var n=Object(k.a)(),r=(new Date).toISOString();return t.id=n,t.time=r,{type:e,info:t}},A=function(e){return{type:"usrinfo",info:e}},L=function(e){return{type:"quickusrinfoid",id:e}},C=function(e){return{type:"quickusrinfopubkey",pubkey:e}},T=function(e,t,n){return{type:"sendedmsg",toid:e,msgid:t,result:n}},P=function(e){return I("sendingmsg",e)},N=function(e){return{type:"receivedmsg",info:e}},B=function(e){return{type:"receivedpubmsg",info:e}},K=function(e,t){return{type:"incleantime",id:e,time:t}},G=function(e,t){return{type:"viewcleantime",id:e,time:t}},M=function(){return{type:"cleansending"}},R=function(){return{type:"cleanreceived"}},J=function(e){return{type:"onchatingid",id:e}},U=function(e){return{type:"newalert",id:e}},q=function(e,t){return{type:"newdecryptmsg",id:e,msg:t}},Z=function(){return{type:"lastsendtime",time:(new Date).toISOString()}},H=function(){return{type:"state_clean"}},Y=n(98),F=n.n(Y),Q=function(){return{id:new Promise(function(e,t){e(Math.floor(9e4*Math.random())+1e4)}),keypair:new Promise(function(e,t){e(function(){var e=new F.a({b:1024});return{publickey:e.exportKey("pkcs8-public-pem"),privatekey:e.exportKey("pkcs8-private-pem")}}())})}},z=n(29),X=n(99),W=n.n(X),_=function(e){var t=new F.a;return t.importKey(function(){var e="-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDpISoIb01KuAcY\nDLJNl9k5tdz/7p4kSNQpqCUy9SJJsx1hPmp4I/MPSPtTnsNwTS2fwF4sIvUeM4IZ\n8+gqJYZ/BQ4Gy0m9buyqVB58Gc9PL7TuHpYoX/Yfwn/qEicJGaikWf3H1wtqPhx7\n92H7Rwgvgrgdn7nyNKrNEgJpsFTC/N4v5asO0ymdL8mDM/HLJXu2X6yD+fT50Z9L\nWXaGo9hmvT+D/ndqIbMIB67m3SagK8Q98ER3RcSKw4LoNyXeOApOfXt1352Tgmax\nzvjbyL3JyuIFRmPf0eCi2akbmpkbR8e3QHppcwnBhUTnTi42huYqtiKeGLFd3gPb\nNfTesRnnAgMBAAECggEAUYDGsSw4WWb9E+tcasQrrYFnQhKqNwU/J1EhsC8DTcDR\nBK5NirMGxtE9DH701M4mpTMbuVJ/X4+ibHBZOmLkIoQh4z4vCYs+Mk42WiyrzYNg\nPd9zn6ns4i2dirfN7eCKlOrhTnxgAUS1sKFMIA01T2bj93dgCs1e6VLihRCgkYor\nSZnWuH3Fh2FfKsZmGgDvMWBuUs3Uhz+O0VAbO/eqwLvu4dZSXUMYNYDBi+F+pIk7\nOEGAnOjd+gwPpadhTS3MhHKF/e6+vPd0CYVaqDlSka9/DD1eqFb+q6kZ6jPHougL\n7SfeGvdtNCFoHHjIIqaN88T7WQ6GcSIlQOo8Y+T8AQKBgQDvdLAojl/fvw7QTfjN\nijnxjN57BTavUQ1gOOH0EdBNkTLkmSatxG5OwrbY6NpwBqoe9NljoJX5YxXWTUBh\nMJpqdGomsb1Fra5+JvmpMpN/4ZZL8UmisQ9HBfWSTYMUXqwPFpsTwFuJc0SBxa/V\nw4CAMfNGHUCQgbwlBc3LpURV5QKBgQD5PJT4SSjxI8W6JRRWqZnq2fSuxwd7DhWE\n9juo75wMWWYRpWvxHZhWDUKiXXC39mEcsBkaa6z9iSzZ0LIK4lz60jhmGhHvAdNc\nYACG7aH+JD/XMsak34BgYGEqnJkbXa84ZAAXQSoAiLoCzCfymdU6xcdXKX5kFOKx\nZEAlfbMz2wKBgCxsG1oKv6KEkTz3mhaXdBRpq8RqvTBc+vxE0TY0L86UBzr9Zn2K\nGWSnHsCywgNSWTEQ/1tKKUhwp1ZwUmc1WxAwtJilFJXemKZymJJY/aAVu4ovIxf5\nfPoSEvKnSo/22DicWvyZDOI87hKdF/eyIx6lJZp2RsoIJ10+7GTBLiI5AoGBAL/+\neC9vhDeGPAnyCGHeErCEp+V/cnbL2a3sVPcFZatprqQHT0iVaMVZP6x92JgOFq8X\nxK7CpadFZaSBDLYvvDqHeGTGzmvUdzJgzeci5bg1ymwHNFjLx0P22sMNkTAwkgsZ\nlaxUSXvR16DSDi/nawf0VWQCldeY8yx9sqBu3X4jAoGAMncKcctLjv4H6kQa+s40\nQOAHroAs7ehL0lNGEtAAvNmgbTuIZSRZ6/gfWHtQ8XbUNBYZbkJrlpS6TEvi7SsB\nvPXfeSnHMI56FXxN9QzeLDEDOSdD0jlW/b+L71gEvXzydD0pkmz8lZ0B6dPpt/zI\n8NDzM2jMbFTTg5ps6EcVk9c=\n-----END PRIVATE KEY-----\n";if("undefined"==typeof localStorage)return e;var t=localStorage.getItem("privateKey");return t||e}(),"pkcs8-private-pem"),t.decrypt(e).toString()},V=function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){var e="-----BEGIN PUBLIC KEY-----\nMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA6SEqCG9NSrgHGAyyTZfZ\nObXc/+6eJEjUKaglMvUiSbMdYT5qeCPzD0j7U57DcE0tn8BeLCL1HjOCGfPoKiWG\nfwUOBstJvW7sqlQefBnPTy+07h6WKF/2H8J/6hInCRmopFn9x9cLaj4ce/dh+0cI\nL4K4HZ+58jSqzRICabBUwvzeL+WrDtMpnS/JgzPxyyV7tl+sg/n0+dGfS1l2hqPY\nZr0/g/53aiGzCAeu5t0moCvEPfBEd0XEisOC6Dcl3jgKTn17dd+dk4Jmsc7428i9\nycriBUZj39HgotmpG5qZG0fHt0B6aXMJwYVE504uNobmKrYinhixXd4D2zX03rEZ\n5wIDAQAB\n-----END PUBLIC KEY-----\n";if("undefined"==typeof localStorage)return e;var t=localStorage.getItem("publicKey");return t||e}(),o={pass:W()(16),iv:W()(16)};return{encryptedpass:function(e,t,n){var r=e+t,i=new F.a;return i.importKey(n,"pkcs8-public-pem"),i.encrypt(r,"base64")}(o.pass,o.iv,i),encryptedcontent:(t=e,n=o.pass,r=o.iv,D.a.AES.encrypt(t,n,{iv:r}).toString())}},$=function(e,t){var n=_(e).split("");return function(e,t,n){return D.a.AES.decrypt(e,t,{iv:n}).toString(D.a.enc.Utf8)}(t,n.slice(0,16).join(""),n.slice(16).join(""))},ee=function(e){var t=e.encryptedpass,n=e.encryptedcontent;return $(t,n)},te=n(476),ne="https://as.toolz.dynv6.net",re={token:"dG9rZW4xMjMK"},ie={getlist:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return te.a.get(function(e,t,n){return ne+"/redis/list/chat/"+e+"/"+t+"/"+n}(e,t,n),{headers:re})},pushtolist:function(e,t){return te.a.post(function(e){return ne+"/redis/push/chat/"+e}(e),t,{headers:re})},setkeyjson:function(e,t){return te.a.post(function(e){return ne+"/redis/setjson/chat/"+e}(e),t,{headers:re})},getkeyvalue:function(e){return te.a.get(function(e){return ne+"/redis/get/chat/"+e}(e),{headers:re})},delkey:function(e){return te.a.get(function(e){return ne+"/redis/del/chat/"+e}(e),{headers:re})}},oe=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return new Promise(function(r,i){ie.getlist(e,t,n).then(function(e){return r(e.data)}).catch(function(e){return i(e)})})};function ae(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,o=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw o}}}}function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ue=function(e,t,n){return e.filter(function(e){return!t.some(function(t){return t[n]===e[n]})})};var le=function(e,t,n){return t.some(function(t){return t[n]===e[n]})};function fe(){return b.getState()}function se(){se=function(){return t};var e,t={},n=Object.prototype,r=n.hasOwnProperty,i=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(e){l=function(e,t,n){return e[t]=n}}function f(e,t,n,r){var o=t&&t.prototype instanceof g?t:g,a=Object.create(o.prototype),c=new L(r||[]);return i(a,"_invoke",{value:S(e,n,c)}),a}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=f;var d="suspendedStart",p="suspendedYield",m="executing",h="completed",v={};function g(){}function y(){}function b(){}var w={};l(w,a,function(){return this});var E=Object.getPrototypeOf,x=E&&E(E(C([])));x&&x!==n&&r.call(x,a)&&(w=x);var O=b.prototype=g.prototype=Object.create(w);function j(e){["next","throw","return"].forEach(function(t){l(e,t,function(e){return this._invoke(t,e)})})}function k(e,t){function n(i,o,a,c){var u=s(e[i],e,o);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==typeof f&&r.call(f,"__await")?t.resolve(f.__await).then(function(e){n("next",e,a,c)},function(e){n("throw",e,a,c)}):t.resolve(f).then(function(e){l.value=e,a(l)},function(e){return n("throw",e,a,c)})}c(u.arg)}var o;i(this,"_invoke",{value:function(e,r){function i(){return new t(function(t,i){n(e,r,t,i)})}return o=o?o.then(i,i):i()}})}function S(t,n,r){var i=d;return function(o,a){if(i===m)throw new Error("Generator is already running");if(i===h){if("throw"===o)throw a;return{value:e,done:!0}}for(r.method=o,r.arg=a;;){var c=r.delegate;if(c){var u=D(c,r);if(u){if(u===v)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===d)throw i=h,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=m;var l=s(t,n,r);if("normal"===l.type){if(i=r.done?h:p,l.arg===v)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=h,r.method="throw",r.arg=l.arg)}}}function D(t,n){var r=n.method,i=t.iterator[r];if(i===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,D(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),v;var o=s(i,t.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,v;var a=o.arg;return a?a.done?(n[t.resultName]=a.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,v):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,v)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function C(t){if(t||""===t){var n=t[a];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,o=function n(){for(;++i<t.length;)if(r.call(t,i))return n.value=t[i],n.done=!1,n;return n.value=e,n.done=!0,n};return o.next=o}}throw new TypeError(typeof t+" is not iterable")}return y.prototype=b,i(O,"constructor",{value:b,configurable:!0}),i(b,"constructor",{value:y,configurable:!0}),y.displayName=l(b,u,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,l(e,u,"GeneratorFunction")),e.prototype=Object.create(O),e},t.awrap=function(e){return{__await:e}},j(k.prototype),l(k.prototype,c,function(){return this}),t.AsyncIterator=k,t.async=function(e,n,r,i,o){void 0===o&&(o=Promise);var a=new k(f(e,n,r,i),o);return t.isGeneratorFunction(n)?a:a.next().then(function(e){return e.done?e.value:a.next()})},j(O),l(O,u,"Generator"),l(O,a,function(){return this}),l(O,"toString",function(){return"[object Generator]"}),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=C,L.prototype={constructor:L,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(A),!t)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function i(r,i){return c.type="throw",c.arg=t,n.next=r,i&&(n.method="next",n.arg=e),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return i("end");if(a.tryLoc<=this.prev){var u=r.call(a,"catchLoc"),l=r.call(a,"finallyLoc");if(u&&l){if(this.prev<a.catchLoc)return i(a.catchLoc,!0);if(this.prev<a.finallyLoc)return i(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return i(a.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return i(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=e,a.arg=t,o?(this.method="next",this.next=o.finallyLoc,v):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),v},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),v}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;A(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:C(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),v}},t}var de=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return new Promise(function(){var r=Object(z.a)(se().mark(function r(i,o){var a,c,u,l;return se().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,oe(e,t,n);case 2:if(a=r.sent,void 0!==(c="public"!==e?a[Number(e)]:a[e])){r.next=7;break}return o(),r.abrupt("return");case 7:u=fe().decryptmsg,l=c.map(function(e){var t,n=JSON.parse(e),r=n.type,i=n.id;if("secret"===r){if(!(i in u)){var o=n.msg,a=n.encryptedpass,c=ee({encryptedpass:a,encryptedcontent:o});return t=new q(i,c),b.dispatch(t),JSON.parse(c)}var l=u[i];if(l)return JSON.parse(l)}return"pub"===r?n.msg:{}}),i(l);case 10:case"end":return r.stop()}},r)}));return function(e,t){return r.apply(this,arguments)}}())},pe=function(e,t){return de(e,t,t)},me=function(){var e=Object(z.a)(se().mark(function e(t){var n,r;return se().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ve(t);case 2:if(void 0!==(n=e.sent)&&null!==n){e.next=5;break}return e.abrupt("return",void 0);case 5:if(void 0!==n["info-"+t]&&null!==n["info-"+t]){e.next=7;break}return e.abrupt("return",void 0);case 7:return r=JSON.parse(n["info-"+t]),e.abrupt("return",r.pubkey);case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=Object(z.a)(se().mark(function e(t,n,r,i){var o,a;return se().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("pub"===r&&(o={type:"pub",msg:n,time:n.time}),"secret"!==r){e.next=10;break}if(void 0!==i){e.next=8;break}return e.next=5,me(t);case 5:if(void 0!==(i=e.sent)){e.next=8;break}return e.abrupt("return",new Promise(function(e,t){t("can not get receiver info")}));case 8:a=V(JSON.stringify(n),i),o={type:"secret",msg:a.encryptedcontent,encryptedpass:a.encryptedpass,time:n.time};case 10:return o.id=n.id,e.abrupt("return",new Promise(function(e,n){var r,i;(r=t,i=o,new Promise(function(e,t){ie.pushtolist(r,i).then(function(t){return e(t.data)}).catch(function(e){return t(e)})})).then(function(t){var n={id:o.id,listnum:t.result};e(n)}).catch(function(e){return n(e)})}));case 12:case"end":return e.stop()}},e)}));return function(t,n,r,i){return e.apply(this,arguments)}}(),ve=function(e){return new Promise(function(t,n){var r;t((r="info-"+e,new Promise(function(e,t){ie.getkeyvalue(r).then(function(t){return e(t.data)}).catch(function(e){return t(e)})})))})},ge=function(e,t){return new Promise(function(n,r){var i,o;n((i="info-"+e,o=t,new Promise(function(e,t){ie.setkeyjson(i,o).then(function(t){return e(t.data)}).catch(function(e){return t(e)})})))})},ye=function(e){return new Promise(function(t,n){var r;t((r=e,new Promise(function(e,t){ie.delkey(r).then(function(t){return e(t.data)}).catch(function(e){return t(e)})})))})},be=n(481),we=n(484),Ee=n(479),xe=n(472),Oe=n(474),je=n(473),ke=n(475),Se=n(166),De=n.n(Se),Ie=n(242),Ae=n.n(Ie),Le=n(9),Ce=n(477),Te=n(482);function Pe(){var e=Object(j.b)().t,t=Object(r.useState)(""),n=Object(Le.a)(t,2),i=n[0],o=n[1];return r.createElement(be.a,{sx:{bgcolor:"background.paper",width:"100%",display:"grid",alignItems:"center",padding:"10px",gridAutoColumns:"1fr",gap:1}},r.createElement(Ce.a,{id:"channelid",variant:"outlined",value:i,onChange:function(e){o(e.target.value)},sx:{gridRow:"1",gridColumn:"1 / 6"}}),r.createElement(Te.a,{color:"inherit",component:"a",href:"/chat/"+i,sx:{gridRow:"1",gridColumn:"6 / 7"}},e("chat")))}var Ne=n(124),Be=n(468),Ke=n(469),Ge=n(470),Me=n(471),Re=[Be.a,Ke.a,Ge.a,Me.a];function Je(){var e=Object(j.b)().t,t=Object(c.c)(function(e){return e.usrinfo.id}),n=Object(c.c)(function(e){return e.newalert}),i=Object(c.c)(function(e){return e.onchatingid}),o=Object(Ne.a)(function(e){return e.sending},function(e){return e.received},function(e,t){var n=Object.keys(e),r=Object.keys(t),i=n.concat(r);return Array.from(new Set(i))}),a=Object(c.c)(o),u=function(e){var t,n=new Set,r=[],i=ae(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;n.has(o.id)||(n.add(o.id),r.push(o))}}catch(a){i.e(a)}finally{i.f()}return r}(a.filter(function(e){return"public"!==e})).map(function(e){var t=e===n&&i!==n;return r.createElement(Ee.a,{key:e,disablePadding:!0},r.createElement(xe.a,{component:"a",href:"/chat/"+e},function(){var e=Math.floor(Math.random()*Re.length),t=Re[e];return r.createElement(t,{style:{marginRight:"8px"}})}(),r.createElement(je.a,null,e),t&&r.createElement("span",{style:{color:"green",marginLeft:"1px"}},r.createElement(Ae.a,{fontSize:"small"}))))});return r.createElement(be.a,{sx:{width:"100%",bgcolor:"background.paper"}},r.createElement("nav",{"aria-label":"main mailbox folders"},r.createElement(we.a,null,r.createElement(Ee.a,{disablePadding:!0},r.createElement(xe.a,{component:"a",href:"/chat/public"},r.createElement(Oe.a,null,r.createElement(De.a,null)),r.createElement(je.a,{primary:e("publicchat")}))),r.createElement(Ee.a,{disablePadding:!0},r.createElement(xe.a,{component:"a",href:"/chat/"+t},r.createElement(Oe.a,null,r.createElement(De.a,null)),r.createElement(je.a,{primary:e("note")}))),r.createElement(Ee.a,{disablePadding:!0},r.createElement(Pe,null)))),r.createElement(ke.a,null),r.createElement("nav",{"aria-label":"secondary mailbox folders"},r.createElement(we.a,null,u)))}var Ue=n(485),qe=n(486),Ze=n(130),He=n(487),Ye=n(247),Fe=n.n(Ye),Qe=n(245),ze=n.n(Qe),Xe=n(167),We=n.n(Xe),_e=n(246),Ve=n.n(_e),$e=n(251),et=n(488);function tt(e){var t=e.cleanwhat,n=t,i=Object(j.b)().t,o=Object(c.b)(),a=Object(c.c)(function(e){return e.usrinfo.id}),u=r.useState(null),l=Object(Le.a)(u,2),f=l[0],s=l[1];return r.createElement(Ue.a,{position:"static",sx:{backgroundColor:"rgba(0, 0, 0, 0.6)"}},r.createElement(qe.a,null,r.createElement(He.a,{color:"inherit",component:"a",href:"/"},r.createElement(ze.a,{sx:{marginLeft:"-10px"}})),"all"===t&&r.createElement(Ze.a,{variant:"h7",component:"div",sx:{flexGrow:1}},i("yourid")," ",a),"all"!==t&&t!==a&&r.createElement(Ze.a,{variant:"h7",component:"div",sx:{flexGrow:1}},i("his"),"id: ",n),t===a&&r.createElement(Ze.a,{variant:"h7",component:"div",sx:{flexGrow:1}},i("note")," ",r.createElement(Ve.a,{sx:{marginBottom:"-5px"}})),r.createElement(He.a,{edge:"end",color:"inherit","aria-label":"more-vert","aria-controls":"menu","aria-haspopup":"true",onClick:function(e){s(e.currentTarget)}},r.createElement(Fe.a,null)),r.createElement($e.a,{id:"menu",anchorEl:f,keepMounted:!0,open:Boolean(f),onClose:function(){s(null)}},r.createElement(et.a,{onClick:function(){if("all"!==t){var e=(new Date).toISOString(),n=new G(t,e);o(n)}if("all"===t){ye(a);var r=(new Date).toISOString();o(new M),o(new R),o(new K("public",r)),o(new K(a,r))}s(null)}},r.createElement(We.a,{sx:{marginRight:1}}),i("clear")),"all"===t&&r.createElement(et.a,{onClick:function(){ye(a),ye("info-"+a).then(function(e){console.log(e)}),o(new H),localStorage.clear(),setTimeout(function(){window.location.reload()},2e3),s(null)}},r.createElement(We.a,{sx:{marginRight:1}}),i("clearcompletely")))))}var nt=function(){return Object(c.b)()(new J("home")),i.a.createElement("div",null,i.a.createElement(tt,{cleanwhat:"all"}),i.a.createElement(Je,null))};function rt(e){var t=e.setInputText,n=e.setRandomText,i=Object(j.b)().t,o=Object(r.useRef)(""),a=Object(c.b)(),u=function(){a(new Z),n(W()(5)),t(o.current.value),o.current.value=""},l=Object(r.useRef)(!1);return r.createElement(be.a,{sx:{position:"sticky",bottom:"10px",width:"100%",bgcolor:"background.paper",alignItems:"center",padding:"10px",display:"grid",gridAutoColumns:"1fr",gap:1},id:"inputbox"},r.createElement(Ce.a,{inputRef:o,onKeyUp:function(e){"Control"===e.key&&(l.current=!1)},onKeyDown:function(e){"Control"===e.key?l.current=!0:"Enter"===e.key&&l.current&&u()},variant:"outlined",multiline:!0,sx:{gridRow:"1",gridColumn:"1/12"}}),r.createElement(Te.a,{onClick:u,sx:{gridRow:"1",gridColumn:"12/15",color:"#ab003c"}},i("send")),r.createElement(be.a,{sx:{gridRow:"1",gridColumn:"15/16"}}))}var it=n(483);function ot(e){var t,n=e.channelid,i=Object(c.c)(function(e){return e.usrinfo.id}),o=Object(c.c)(function(e){return e.viewcleantime[n]}),a=Object(r.useRef)(null),u=Object(Ne.a)(function(e){return e.sending[n]},function(e){return e.received[n]},function(e,t){var n=[];return e&&n.push.apply(n,Object(E.a)(e)),t&&n.push.apply(n,Object(E.a)(t)),n.sort(function(e,t){return new Date(e.time)-new Date(t.time)}),n}),l=Object(c.c)(u);if(void 0!==o){var f=new Date(o);t=l.filter(function(e){return new Date(e.time)>f})}else t=l;var s=t.map(function(e){var t=new Date(e.time),n="",o={};e.fromid===i?(n="right",o={paddingLeft:"50px",paddingRight:"10px",backgroundColor:"sending"===e.msgstatus?"#87CEFA":"sended"===e.msgstatus?"#eaeaea":"failed"===e.msgstatus?"#ffcccc":""}):(n="left",o={paddingLeft:"10px",paddingRight:"50px"});var a=null,c=function(){navigator.clipboard.writeText(e.text).then(function(){console.log("Text copied to clipboard")}).catch(function(e){console.error("Error copying text to clipboard:",e)})};return r.createElement(Ee.a,{key:e.id,disablePadding:!0,style:o},r.createElement(xe.a,{disableRipple:!0,onMouseDown:function(){a=setTimeout(function(){c()},1e3)},onMouseUp:function(){clearTimeout(a)}},r.createElement(je.a,{align:n},r.createElement("div",{style:{display:"block",userSelect:"text"}},r.createElement("span",null,e.text),r.createElement("span",null," "),r.createElement(it.a,{elevation:0,style:{display:"inline-block",padding:"5px",fontSize:"10px",color:"gray",whiteSpace:"nowrap"}},t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}))))))});return Object(r.useEffect)(function(){a.current&&(a.current.scrollTop=a.current.scrollHeight)},[u]),r.createElement(be.a,{ref:a,sx:{maxHeight:"calc(100vh - 160px)",width:"100%",bgcolor:"background.paper",flexGrow:1,overflowY:"auto"}},r.createElement(ke.a,null),r.createElement("nav",{"aria-label":"secondary mailbox folders"},r.createElement(we.a,null,s)))}function at(){var e=Object(c.b)(),t=Object(O.p)().channelid,n=Object(c.c)(function(e){return e.newalert}),i=Object(c.c)(function(e){return e.onchatingid}),o=Object(c.c)(function(e){return e.usrinfo.id}),a=Object(c.c)(function(e){return e.usrinfo.id}),u=Object(r.useState)(""),l=Object(Le.a)(u,2),f=l[0],s=l[1],d=Object(r.useState)(""),m=Object(Le.a)(d,2),h=m[0],v=m[1],g=Object(r.useRef)({}),y=Object(r.useRef)(!0);return Object(r.useEffect)(function(){""!==f&&function(){var n,r={fromid:a,toid:t,text:f,msgstatus:"sending"},i=P(r);e(i);var o=Object(p.cloneDeep)(i.info);if(delete o.msgstatus,"public"===r.toid)n=he(r.toid,o,"pub");else{if(null===g.current){var c=T(t,o.id,"failed");return void e(c)}n=void 0!==g.current.pubkey?he(r.toid,o,"secret"):he(r.toid,o,"secret",g.current.pubkey)}n.then(function(n){var r=T(t,n.id,"sended");e(r),console.log("send sucess"),console.log(n.id),console.log(n.listnum)}),n.catch(function(n){var r=T(t,o.id,"failed");e(r)})}()},[h,f]),Object(r.useEffect)(function(){return y.current=!0,n===i&&y.current&&0!==n&&e(new U(0)),function(){y.current=!1}},[i]),Object(r.useEffect)(function(){(e(new J(t)),"public"!==t)&&ve(t).then(function(e){g.current=JSON.parse(e["info-"+t]),void 0===g.current&&(g.current={})});if("public"===t){var n=0,r=setInterval(function(){n+=1,console.log("loop ...pub"+n);var r=de(t),i=fe().received[t];r.then(function(n){var r,a=n.filter(function(e){return e.fromid!==o}),c=fe().incleantime[t];if(void 0!==c){var u=new Date(c);r=a.filter(function(e){return new Date(e.time)>u})}else r=a;void 0===i?(console.log("received list get null"),r.map(function(t){return e(new B(t)),t.id})):ue(r,i,"id").map(function(t){return le(t,i,"id")||e(new B(t)),t.id})})},1e4);return function(){console.log("Stop public channel polling"),clearInterval(r)}}},[]),r.createElement(be.a,{sx:{position:"fixed",top:0,left:0,width:"100%",height:"100vh",display:"flex",flexDirection:"column"}},r.createElement(tt,{cleanwhat:t}),r.createElement(ot,{channelid:t}),r.createElement(rt,{setRandomText:v,setInputText:s}))}var ct=function(){var e=Object(j.b)().i18n,t=Object(r.useRef)(navigator.language),n=Object(c.b)(),o=Object(c.c)(function(e){return e.usrinfo.id}),a=Object(c.c)(function(e){return e.usrinfo.pubkey}),u=Object(c.c)(function(e){return e.onchatingid}),l=Object(c.c)(function(e){return e.lastsendtime}),f=Object({NODE_ENV:"production",PUBLIC_URL:"",REACT_APP_PUSH_URL:"https://as.toolz.dynv6.net",REACT_APP_TOKEN:"dG9rZW4xMjMK"}).REACT_APP_Polling_Interval||5,s=Object(r.useRef)(0);return Object(r.useEffect)(function(){var e,t=localStorage.getItem("userId"),r=localStorage.getItem("publicKey");if(t&&r)n(new A({id:t,pubkey:r}));else{var i=Q();i.id.then(function(e){t=e,localStorage.setItem("userId",t),n(new L(e))}),i.keypair.then(function(t){r=t.publickey,e=t.privatekey,localStorage.setItem("publicKey",r),localStorage.setItem("privateKey",e),n(new C(r)),setTimeout(function(){window.location.reload()},1e3)})}var a=new Date;a.setDate(a.getDate()-1);var c=a.toISOString(),u=new K("public",c);void 0===fe().incleantime.public&&n(u);var l=new Date;l.setDate(l.getDate()-30);var f=l.toISOString(),s=new K(o,f);void 0===fe().incleantime[o]&&n(s)},[a]),Object(r.useEffect)(function(){if(void 0!==o&&void 0!==a){var e={id:o,pubkey:a};ge(e.id,e).then(function(e){return console.log("update usrinfo to server")})}},[a]),Object(r.useEffect)(function(){var e=0,t=setInterval(function(){if(s.current=s.current+1,void 0!==o||void 0!==a){var t=!1;if(""!==l){var r=new Date(l),i=(new Date).getTime()-r.getTime();t=Math.floor(i/6e4)>15}else t=!0;if(console.log("\n"),console.log("should skip this: "+t),t&&s.current<3)console.log("skip this loop ...");else{e+=1,s.current=0,console.log("loop ..."+e);var c=fe().received,f=Object(p.cloneDeep)(c);delete f.public,pe(o,0,0).then(function(e){var t,r=(t=[]).concat.apply(t,Object(E.a)(Object.values(f))),i=ue(e,r,"id"),a=!1;(void 0===f||i.length>0)&&(a=!0),console.log("need get all list: "+a),a&&de(o).then(function(e){var t,i=e.filter(function(e){return e.fromid!==o}),a=fe().incleantime[o];if(void 0!==a){var c=new Date(a);t=i.filter(function(e){return new Date(e.time)>c})}else t=i;void 0===f?(console.log("received list get null"),t.map(function(e){return n(new N(e)),e.id})):ue(t,r,"id").map(function(e){return le(e,r,"id")||(n(new N(e)),e.fromid!==u&&(console.log("\u65b0\u6d88\u606f\u4ece:"+e.fromid),n(new U(e.fromid)))),e.id})})})}}},1e3*parseInt(f));return function(){console.log("Stop polling"),clearInterval(t)}},[]),Object(r.useEffect)(function(){e.changeLanguage(t.current),document.title=e.t("app")},[t]),i.a.createElement(x.a,null,i.a.createElement(O.c,null,i.a.createElement(O.a,{path:"/",element:i.a.createElement(nt,null)}),i.a.createElement(O.a,{path:"/chat/:channelid",element:i.a.createElement(at,null)})))},ut=n(248),lt=n(249),ft=n(250);ut.a.use(j.a).init({resources:{en:{translation:lt},zh:{translation:ft}},lng:"en",fallbackLng:"en",interpolation:{escapeValue:!1}}),a.a.render(i.a.createElement(c.a,{store:b},i.a.createElement(u.a,{loading:null,persistor:w},i.a.createElement(i.a.StrictMode,null,i.a.createElement(ct,null)))),document.getElementById("root"))}},[[269,1,2]]]);
//# sourceMappingURL=main.25397dbb.chunk.js.map